version: '3.7'
x-default-logging: &default
  {}
x-loki-logging: &loki
  driver: loki
  options:
    loki-url: http://localhost:3100/loki/api/v1/push
    mode: non-blocking
    max-buffer-size: 4m
    loki-retries: "3"
x-log-config: &log-config
  <<: *default
services:

  odoo-16:
    profiles: ["odoo-16"]
    image: 'bahmni/odoo-16:${ODOO_IMAGE_TAG:?[ERROR]}'
    ports:
      - '8069:8069'
    depends_on:
      odoodb:
        condition: service_healthy
    environment:
      HOST: odoodb
      USER: ${ODOO_DB_USER}
      PASSWORD: ${ODOO_DB_PASSWORD}
    logging: *log-config

  odoodb:
    profiles: ["odoo-16"]
    image: 'postgres:${ODOO_DB_IMAGE_TAG:?[ERROR]}'
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -h localhost -U odoo']
      interval: 10s
      timeout: 5s
    environment:
      POSTGRES_DB: postgres
      POSTGRES_PASSWORD: ${ODOO_DB_PASSWORD}
      POSTGRES_USER: ${ODOO_DB_USER}
    logging: *log-config
    
volumes:
  odoodbdata:
  odooappdata: